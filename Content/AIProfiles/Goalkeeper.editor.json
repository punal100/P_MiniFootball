{
    "schemaVersion": 1,
    "name": "Goalkeeper",
    "initialState": "Main",
    "states": [
        {
            "id": "Main",
            "terminal": false,
            "onEnter": [
                {
                    "actionName": "Log",
                    "paramsJson": "{ \"message\": \"Goalkeeper AI Active - Main\" }"
                }
            ],
            "onTick": [
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.EvaluateShot\" }"
                }
            ],
            "onExit": [],
            "transitions": [
                {
                    "to": "DistributeBall",
                    "priority": 10000,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "HasBall",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "true"
                        }
                    }
                },
                {
                    "to": "ThreatEvaluation",
                    "priority": 9000,
                    "condition": {
                        "type": "And",
                        "conditions": [
                            {
                                "type": "Blackboard",
                                "keyOrName": "IsShotTowardsGoal",
                                "op": "Equal",
                                "compareValue": {
                                    "type": "Bool",
                                    "rawValue": "true"
                                }
                            },
                            {
                                "type": "Blackboard",
                                "keyOrName": "DiveCooldownActive",
                                "op": "Equal",
                                "compareValue": {
                                    "type": "Bool",
                                    "rawValue": "false"
                                }
                            }
                        ]
                    }
                },
                {
                    "to": "ChaseBall",
                    "priority": 8000,
                    "condition": {
                        "type": "And",
                        "conditions": [
                            {
                                "type": "Blackboard",
                                "keyOrName": "IsBallLoose",
                                "op": "Equal",
                                "compareValue": {
                                    "type": "Bool",
                                    "rawValue": "true"
                                }
                            },
                            {
                                "type": "Blackboard",
                                "keyOrName": "DistToBall",
                                "op": "LessThan",
                                "compareValue": {
                                    "type": "Float",
                                    "rawValue": "1500.0"
                                }
                            }
                        ]
                    }
                },
                {
                    "to": "PositionForSave",
                    "priority": 7000,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "OpponentHasBall",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "true"
                        }
                    }
                },
                {
                    "to": "GuardGoal",
                    "priority": 100,
                    "condition": {
                        "type": "Timer",
                        "seconds": 0.0
                    }
                }
            ]
        },

        {
            "id": "ThreatEvaluation",
            "terminal": false,
            "onEnter": [
                { "actionName": "Log", "paramsJson": "{ \"message\": \"Threat evaluation\" }" },
                { "actionName": "Execute", "paramsJson": "{ \"target\": \"MF.EvaluateShot\" }" }
            ],
            "onTick": [],
            "onExit": [],
            "transitions": [
                {
                    "to": "PrepareDive",
                    "priority": 1000,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "IsDiveRecommended",
                        "op": "Equal",
                        "compareValue": { "type": "Bool", "rawValue": "true" }
                    }
                },
                {
                    "to": "PositionForSave",
                    "priority": 900,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "ShotIsWide",
                        "op": "Equal",
                        "compareValue": { "type": "Bool", "rawValue": "true" }
                    }
                },
                {
                    "to": "GuardGoal",
                    "priority": 800,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "ShotHandled",
                        "op": "Equal",
                        "compareValue": { "type": "Bool", "rawValue": "true" }
                    }
                },
                {
                    "to": "PositionForSave",
                    "priority": 100,
                    "condition": { "type": "Timer", "seconds": 0.10 }
                }
            ]
        },

        {
            "id": "PrepareDive",
            "terminal": false,
            "onEnter": [
                { "actionName": "Log", "paramsJson": "{ \"message\": \"Prepare dive (windup)\" }" }
            ],
            "onTick": [],
            "onExit": [],
            "transitions": [
                { "to": "Diving", "priority": 100, "condition": { "type": "Timer", "seconds": 0.08 } },
                { "to": "PositionForSave", "priority": 50, "condition": { "type": "Blackboard", "keyOrName": "ShotIsWide", "op": "Equal", "compareValue": { "type": "Bool", "rawValue": "true" } } }
            ]
        },

        {
            "id": "Diving",
            "terminal": false,
            "onEnter": [
                { "actionName": "Log", "paramsJson": "{ \"message\": \"Diving\" }" },
                { "actionName": "Execute", "paramsJson": "{ \"target\": \"MF.PerformDive\" }" }
            ],
            "onTick": [],
            "onExit": [
                { "actionName": "Execute", "paramsJson": "{ \"target\": \"MF.SetCooldown\", \"params\": { \"key\": \"dive\", \"seconds\": 1.5 } }" }
            ],
            "transitions": [
                { "to": "DistributeBall", "priority": 200, "condition": { "type": "Blackboard", "keyOrName": "HasBall", "op": "Equal", "compareValue": { "type": "Bool", "rawValue": "true" } } },
                { "to": "Recovering", "priority": 100, "condition": { "type": "Blackboard", "keyOrName": "DiveComplete", "op": "Equal", "compareValue": { "type": "Bool", "rawValue": "true" } } }
            ]
        },

        {
            "id": "Recovering",
            "terminal": false,
            "onEnter": [
                { "actionName": "Log", "paramsJson": "{ \"message\": \"Recovering\" }" }
            ],
            "onTick": [],
            "onExit": [],
            "transitions": [
                { "to": "PositionForSave", "priority": 100, "condition": { "type": "Timer", "seconds": 0.70 } }
            ]
        },
        {
            "id": "DistributeBall",
            "terminal": false,
            "onEnter": [
                {
                    "actionName": "Log",
                    "paramsJson": "{ \"message\": \"Distributing ball\" }"
                },
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.Pass\", \"params\": { \"power\": 0.75 } }"
                }
            ],
            "onTick": [],
            "onExit": [
                { "actionName": "Execute", "paramsJson": "{ \"target\": \"MF.ClearTarget\" }" }
            ],
            "transitions": [
                {
                    "to": "Main",
                    "priority": 100,
                    "condition": {
                        "type": "Timer",
                        "seconds": 0.5
                    }
                }
            ]
        },
        {
            "id": "ChaseBall",
            "terminal": false,
            "onEnter": [
                {
                    "actionName": "Log",
                    "paramsJson": "{ \"message\": \"Coming out for ball!\" }"
                },
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.Sprint\", \"params\": { \"active\": true } }"
                }
            ],
            "onTick": [
                {
                    "actionName": "MoveTo",
                    "paramsJson": "{ \"target\": \"Ball\" }"
                }
            ],
            "onExit": [
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.Sprint\", \"params\": { \"active\": false } }"
                }
            ],
            "transitions": [
                {
                    "to": "Main",
                    "priority": 100,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "HasBall",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "true"
                        }
                    }
                },
                {
                    "to": "GuardGoal",
                    "priority": 50,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "DistToBall",
                        "op": "GreaterThan",
                        "compareValue": {
                            "type": "Float",
                            "rawValue": "2000.0"
                        }
                    }
                }
            ]
        },
        {
            "id": "PositionForSave",
            "terminal": false,
            "onEnter": [
                {
                    "actionName": "Log",
                    "paramsJson": "{ \"message\": \"Positioning for save\" }"
                }
            ],
            "onTick": [
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.EvaluateShot\" }"
                },
                {
                    "actionName": "MoveTo",
                    "paramsJson": "{ \"target\": \"GK_TargetPosition\" }"
                },
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.Face\", \"params\": { \"target\": \"Ball\" } }"
                }
            ],
            "onExit": [],
            "transitions": [
                {
                    "to": "Main",
                    "priority": 100,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "OpponentHasBall",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "false"
                        }
                    }
                },
                {
                    "to": "ThreatEvaluation",
                    "priority": 200,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "IsShotTowardsGoal",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "true"
                        }
                    }
                }
            ]
        },
        {
            "id": "GuardGoal",
            "terminal": false,
            "onEnter": [
                {
                    "actionName": "Log",
                    "paramsJson": "{ \"message\": \"Guarding goal\" }"
                }
            ],
            "onTick": [
                {
                    "actionName": "MoveTo",
                    "paramsJson": "{ \"target\": \"Home\" }"
                },
                {
                    "actionName": "Execute",
                    "paramsJson": "{ \"target\": \"MF.Face\", \"params\": { \"target\": \"Ball\" } }"
                }
            ],
            "onExit": [],
            "transitions": [
                {
                    "to": "Main",
                    "priority": 100,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "DistToHome",
                        "op": "LessThan",
                        "compareValue": {
                            "type": "Float",
                            "rawValue": "50.0"
                        }
                    }
                },
                {
                    "to": "ThreatEvaluation",
                    "priority": 500,
                    "condition": {
                        "type": "Blackboard",
                        "keyOrName": "IsShotTowardsGoal",
                        "op": "Equal",
                        "compareValue": {
                            "type": "Bool",
                            "rawValue": "true"
                        }
                    }
                }
            ]
        }
    ],
    "editor": {
        "nodes": {
            "Main": {
                "pos": {
                    "x": 100,
                    "y": 200
                },
                "color": "#2A2A2A"
            },
            "ThreatEvaluation": {
                "pos": {
                    "x": 260,
                    "y": 40
                },
                "color": "#5A2A2A"
            },
            "PrepareDive": {
                "pos": {
                    "x": 440,
                    "y": 40
                },
                "color": "#6A2A2A"
            },
            "Diving": {
                "pos": {
                    "x": 620,
                    "y": 40
                },
                "color": "#7A2A2A"
            },
            "Recovering": {
                "pos": {
                    "x": 800,
                    "y": 40
                },
                "color": "#8A2A2A"
            },
            "DistributeBall": {
                "pos": {
                    "x": 400,
                    "y": 50
                },
                "color": "#3A5A3A"
            },
            "ChaseBall": {
                "pos": {
                    "x": 400,
                    "y": 150
                },
                "color": "#3A3A5A"
            },
            "PositionForSave": {
                "pos": {
                    "x": 400,
                    "y": 250
                },
                "color": "#5A5A3A"
            },
            "GuardGoal": {
                "pos": {
                    "x": 400,
                    "y": 350
                },
                "color": "#2A2A2A"
            }
        },
        "edges": [],
        "viewport": {
            "zoom": 1.0,
            "pan": {
                "x": 0,
                "y": 0
            }
        }
    }
}